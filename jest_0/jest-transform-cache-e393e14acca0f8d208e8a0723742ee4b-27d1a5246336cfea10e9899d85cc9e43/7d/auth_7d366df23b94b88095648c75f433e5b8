a0d41ba49699867850055a2725e561b8
"use strict";

var _interopRequireDefault = require("/home/programowanie4/Pulpit/Luty/React-TheBurger/node_modules/@babel/runtime/helpers/interopRequireDefault");

var _interopRequireWildcard = require("/home/programowanie4/Pulpit/Luty/React-TheBurger/node_modules/@babel/runtime/helpers/interopRequireWildcard");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.authCheckState = exports.setAuthRedirectPath = exports.auth = exports.checkAuthTimeOut = exports.logout = exports.authFail = exports.authSuccess = exports.authStart = void 0;

var actionTypes = _interopRequireWildcard(require("./actionTypes"));

var _axios = _interopRequireDefault(require("axios"));

const authStart = () => {
  return {
    type: actionTypes.AUTH_START
  };
};

exports.authStart = authStart;

const authSuccess = (token, userId) => {
  return {
    type: actionTypes.AUTH_SUCCESS,
    idToken: token,
    userId: userId
  };
};

exports.authSuccess = authSuccess;

const authFail = error => {
  return {
    type: actionTypes.AUTH_FAIL,
    error: error
  };
};

exports.authFail = authFail;

const logout = () => {
  localStorage.removeItem('token');
  localStorage.removeItem('expirationDate');
  localStorage.removeItem('localId');
  return {
    type: actionTypes.AUTH_LOGOUT
  };
};

exports.logout = logout;

const checkAuthTimeOut = expirationTime => {
  return dispatch => {
    setTimeout(() => {
      dispatch(logout());
    }, expirationTime * 1000);
  };
};

exports.checkAuthTimeOut = checkAuthTimeOut;

const auth = (email, password, isSignUp) => {
  return dispatch => {
    dispatch(authStart());
    const authData = {
      email: email,
      password: password,
      returnSecureToken: true
    };
    let url = 'https://www.googleapis.com/identitytoolkit/v3/relyingparty/signupNewUser?key=AIzaSyDEEx2G2BLB7YwRVPqMEVUHCKsQj3ZRRL0';

    if (!isSignUp) {
      url = 'https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=AIzaSyDEEx2G2BLB7YwRVPqMEVUHCKsQj3ZRRL0';
    }

    _axios.default.post(url, authData).then(response => {
      const expirationDate = new Date(new Date().getTime() + response.data.expiresIn * 1000);
      localStorage.setItem('token', response.data.idToken);
      localStorage.setItem('expirationDate', expirationDate);
      localStorage.setItem('userId', response.data.localId);
      dispatch(authSuccess(response.data.idToken, response.data.localId));
      dispatch(checkAuthTimeOut(response.data.expiresIn));
    }).catch(err => {
      console.log(err);
      dispatch(authFail(err.response.data.error));
    });
  };
};

exports.auth = auth;

const setAuthRedirectPath = path => {
  return {
    type: actionTypes.SET_AUTH_REDIRECT_PATH,
    path: path
  };
};

exports.setAuthRedirectPath = setAuthRedirectPath;

const authCheckState = () => {
  return dispatch => {
    const token = localStorage.getItem('token');

    if (!token) {
      dispatch(logout);
    } else {
      const expirationDate = new Date(localStorage.getItem('expirationDate'));

      if (expirationDate <= new Date()) {
        dispatch(logout());
      } else {
        const userId = localStorage.getItem('userId');
        dispatch(authSuccess(token, userId));
        dispatch(checkAuthTimeOut(expirationDate.getTime() - new Date().getTime()));
      }
    }
  };
};

exports.authCheckState = authCheckState;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImF1dGguanMiXSwibmFtZXMiOlsiYXV0aFN0YXJ0IiwidHlwZSIsImFjdGlvblR5cGVzIiwiQVVUSF9TVEFSVCIsImF1dGhTdWNjZXNzIiwidG9rZW4iLCJ1c2VySWQiLCJBVVRIX1NVQ0NFU1MiLCJpZFRva2VuIiwiYXV0aEZhaWwiLCJlcnJvciIsIkFVVEhfRkFJTCIsImxvZ291dCIsImxvY2FsU3RvcmFnZSIsInJlbW92ZUl0ZW0iLCJBVVRIX0xPR09VVCIsImNoZWNrQXV0aFRpbWVPdXQiLCJleHBpcmF0aW9uVGltZSIsImRpc3BhdGNoIiwic2V0VGltZW91dCIsImF1dGgiLCJlbWFpbCIsInBhc3N3b3JkIiwiaXNTaWduVXAiLCJhdXRoRGF0YSIsInJldHVyblNlY3VyZVRva2VuIiwidXJsIiwiYXhpb3MiLCJwb3N0IiwidGhlbiIsInJlc3BvbnNlIiwiZXhwaXJhdGlvbkRhdGUiLCJEYXRlIiwiZ2V0VGltZSIsImRhdGEiLCJleHBpcmVzSW4iLCJzZXRJdGVtIiwibG9jYWxJZCIsImNhdGNoIiwiZXJyIiwiY29uc29sZSIsImxvZyIsInNldEF1dGhSZWRpcmVjdFBhdGgiLCJwYXRoIiwiU0VUX0FVVEhfUkVESVJFQ1RfUEFUSCIsImF1dGhDaGVja1N0YXRlIiwiZ2V0SXRlbSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7QUFBQTs7QUFFQTs7QUFFTyxNQUFNQSxTQUFTLEdBQUcsTUFBTTtBQUMzQixTQUFNO0FBQ0ZDLElBQUFBLElBQUksRUFBRUMsV0FBVyxDQUFDQztBQURoQixHQUFOO0FBR0gsQ0FKTTs7OztBQU1BLE1BQU1DLFdBQVcsR0FBRyxDQUFDQyxLQUFELEVBQVFDLE1BQVIsS0FBbUI7QUFDMUMsU0FBTTtBQUNGTCxJQUFBQSxJQUFJLEVBQUVDLFdBQVcsQ0FBQ0ssWUFEaEI7QUFFRkMsSUFBQUEsT0FBTyxFQUFFSCxLQUZQO0FBR0ZDLElBQUFBLE1BQU0sRUFBRUE7QUFITixHQUFOO0FBS0gsQ0FOTTs7OztBQVFBLE1BQU1HLFFBQVEs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QU1iLEtBQUssR0FBR1EsWUFBWSxDQUFDaUMsT0FBYixDQUFxQixPQUFyQixDQUFkOztBQUNBLFFBQUcsQ0FBQ3pDLEtBQUosRUFBVTtBQUNOYSxNQUFBQSxRQUFRLENBQUNOLE1BQUQsQ0FBUjtBQUNILEtBRkQsTUFFTztBQUNILFlBQU1tQixjQUFjLEdBQUcsSUFBSUMsSUFBSixDQUFTbkIsWUFBWSxDQUFDaUMsT0FBYixDQUFxQixnQkFBckIsQ0FBVCxDQUF2Qjs7QUFDQSxVQUFHZixjQUFjLElBQUUsSUFBSUMsSUFBSixFQUFuQixFQUE4QjtBQUMxQmQsUUFBQUEsUUFBUSxDQUFDTixNQUFNLEVBQVAsQ0FBUjtBQUNILE9BRkQsTUFFSztBQUNELGNBQU1OLE1BQU0sR0FBR08sWUFBWSxDQUFDaUMsT0FBYixDQUFxQixRQUFyQixDQUFmO0FBQ0E1QixRQUFBQSxRQUFRLENBQUNkLFdBQVcsQ0FBQ0MsS0FBRCxFQUFRQyxNQUFSLENBQVosQ0FBUjtBQUNBWSxRQUFBQSxRQUFRLENBQUNGLGdCQUFnQixDQUFDZSxjQUFjLENBQUNFLE9BQWYsS0FBMkIsSUFBSUQsSUFBSixHQUFXQyxPQUFYLEVBQTVCLENBQWpCLENBQVI7QUFDSDtBQUVKO0FBQ0osR0FmRDtBQWdCSCxDQWpCTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCAqIGFzIGFjdGlvblR5cGVzIGZyb20gJy4vYWN0aW9uVHlwZXMnXG5cbmltcG9ydCBheGlvcyBmcm9tICdheGlvcydcblxuZXhwb3J0IGNvbnN0IGF1dGhTdGFydCA9ICgpID0+IHtcbiAgICByZXR1cm57XG4gICAgICAgIHR5cGU6IGFjdGlvblR5cGVzLkFVVEhfU1RBUlRcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBhdXRoU3VjY2VzcyA9ICh0b2tlbiwgdXNlcklkKSA9PiB7XG4gICAgcmV0dXJue1xuICAgICAgICB0eXBlOiBhY3Rpb25UeXBlcy5BVVRIX1NVQ0NFU1MsXG4gICAgICAgIGlkVG9rZW46IHRva2VuLFxuICAgICAgICB1c2VySWQ6IHVzZXJJZFxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGF1dGhGYWlsID0gKGVycm9yKSA9PiB7XG4gICAgcmV0dXJue1xuICAgICAgICB0eXBlOiBhY3Rpb25UeXBlcy5BVVRIX0ZBSUwsXG4gICAgICAgIGVycm9yOiBlcnJvclxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGxvZ291dCA9ICgpID0+IHtcbiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndG9rZW4nKVxuICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCdleHBpcmF0aW9uRGF0ZScpXG4gICAgbG9jYWxTdG9yYWdlLnJlbW92ZUl0ZW0oJ2xvY2FsSWQnKVxuICAgIHJldHVybntcbiAgICAgICAgdHlwZTogYWN0aW9uVHlwZXMuQVVUSF9MT0dPVVQsXG5cbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBjaGVja0F1dGhUaW1lT3V0ID0gKGV4cGlyYXRpb25UaW1lKSA9PiB7XG4gICAgcmV0dXJuIGRpc3BhdGNoID0+IHtcbiAgICAgICAgc2V0VGltZW91dCgoKT0+e1xuICAgICAgICAgICAgZGlzcGF0Y2gobG9nb3V0KCkpXG4gICAgICAgIH0sZXhwaXJhdGlvblRpbWUgKiAxMDAwKVxuICAgIH1cbn1cblxuZXhwb3J0IGNvbnN0IGF1dGggPSAoZW1haWwsIHBhc3N3b3JkLCBpc1NpZ25VcCkgPT4ge1xuICAgIHJldHVybiBkaXNwYXRjaCA9PntcbiAgICAgICAgZGlzcGF0Y2goYXV0aFN0YXJ0KCkpO1xuICAgICAgICBjb25zdCBhdXRoRGF0YSA9IHtcbiAgICAgICAgICAgIGVtYWlsOiBlbWFpbCxcbiAgICAgICAgICAgIHBhc3N3b3JkOiBwYXNzd29yZCxcbiAgICAgICAgICAgIHJldHVyblNlY3VyZVRva2VuOiB0cnVlXG4gICAgICAgIH1cbiAgICAgICAgbGV0IHVybCA9ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9pZGVudGl0eXRvb2xraXQvdjMvcmVseWluZ3BhcnR5L3NpZ251cE5ld1VzZXI/a2V5PUFJemFTeURFRXgyRzJCTEI3WXdSVlBxTUVWVUhDS3NRajNaUlJMMCdcbiAgICAgICAgaWYoIWlzU2lnblVwKXtcbiAgICAgICAgICAgIHVybCA9ICdodHRwczovL3d3dy5nb29nbGVhcGlzLmNvbS9pZGVudGl0eXRvb2xraXQvdjMvcmVseWluZ3BhcnR5L3ZlcmlmeVBhc3N3b3JkP2tleT1BSXphU3lERUV4MkcyQkxCN1l3UlZQcU1FVlVIQ0tzUWozWlJSTDAnXG4gICAgICAgIH1cbiAgICAgICAgYXhpb3MucG9zdCh1cmwsIGF1dGhEYXRhKVxuICAgICAgICAudGhlbihyZXNwb25zZT0+e1xuICAgICAgICAgICAgY29uc3QgZXhwaXJhdGlvbkRhdGUgPSBuZXcgRGF0ZShuZXcgRGF0ZSgpLmdldFRpbWUoKSArIHJlc3BvbnNlLmRhdGEuZXhwaXJlc0luICogMTAwMClcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd0b2tlbicscmVzcG9uc2UuZGF0YS5pZFRva2VuKVxuICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2V4cGlyYXRpb25EYXRlJyxleHBpcmF0aW9uRGF0ZSlcbiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VySWQnLHJlc3BvbnNlLmRhdGEubG9jYWxJZClcbiAgICAgICAgICAgIGRpc3BhdGNoKGF1dGhTdWNjZXNzKHJlc3BvbnNlLmRhdGEuaWRUb2tlbiwgcmVzcG9uc2UuZGF0YS5sb2NhbElkKSlcbiAgICAgICAgICAgIGRpc3BhdGNoKGNoZWNrQXV0aFRpbWVPdXQocmVzcG9uc2UuZGF0YS5leHBpcmVzSW4pKVxuICAgICAgICB9KVxuICAgICAgICAuY2F0Y2goZXJyID0+IHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycilcbiAgICAgICAgICAgIGRpc3BhdGNoKGF1dGhGYWlsKGVyci5yZXNwb25zZS5kYXRhLmVycm9yKSlcbiAgICAgICAgfSlcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBzZXRBdXRoUmVkaXJlY3RQYXRoID0gKHBhdGgpID0+IHtcbiAgICByZXR1cm57XG4gICAgICAgIHR5cGU6IGFjdGlvblR5cGVzLlNFVF9BVVRIX1JFRElSRUNUX1BBVEgsXG4gICAgICAgIHBhdGg6IHBhdGhcbiAgICB9XG59XG5cbmV4cG9ydCBjb25zdCBhdXRoQ2hlY2tTdGF0ZSA9ICgpID0+IHtcbiAgICByZXR1cm4gZGlzcGF0Y2ggPT4ge1xuICAgICAgICBjb25zdCB0b2tlbiA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd0b2tlbicpXG4gICAgICAgIGlmKCF0b2tlbil7XG4gICAgICAgICAgICBkaXNwYXRjaChsb2dvdXQpXG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBleHBpcmF0aW9uRGF0ZSA9IG5ldyBEYXRlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdleHBpcmF0aW9uRGF0ZScpKVxuICAgICAgICAgICAgaWYoZXhwaXJhdGlvbkRhdGU8PW5ldyBEYXRlKCkpe1xuICAgICAgICAgICAgICAgIGRpc3BhdGNoKGxvZ291dCgpKVxuICAgICAgICAgICAgfWVsc2V7XG4gICAgICAgICAgICAgICAgY29uc3QgdXNlcklkID0gbG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXJJZCcpXG4gICAgICAgICAgICAgICAgZGlzcGF0Y2goYXV0aFN1Y2Nlc3ModG9rZW4sIHVzZXJJZCkpXG4gICAgICAgICAgICAgICAgZGlzcGF0Y2goY2hlY2tBdXRoVGltZU91dChleHBpcmF0aW9uRGF0ZS5nZXRUaW1lKCkgLSBuZXcgRGF0ZSgpLmdldFRpbWUoKSkpXG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBcbiAgICAgICAgfVxuICAgIH1cbn1cblxuXG5cbiJdfQ==